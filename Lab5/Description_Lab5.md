# Лабораторная №5
**№1.** *Используя creat(), write(), fflush(), close(), gettimeofday(),\
разработать программу, которая открывает файл, записывает туда 300 KB, \
очищает все записи, закрывает и удаляет файл,
а также измеряет и выводит время, затраченное на каждое действие.*

Код: **[task1.c](https://github.com/sapiest/OS_labs/blob/master/Lab5/task1.c)** получаем:

```
Create: 0.000051
Write: 0.000185
Fflush: 0.003051
Close: 0.000014
Remove: 0.000124
```

**№2.** *Разработать программу, которая замеряет время для 300,000 однобайтовых записей с использованием\
a) напрямую POSIX: creat(), write(), close().\
b) с использованием библиотеки stdio (напр., fopen(), fwrite(), and fclose()).\
Сравнить и объяснить результаты.*

```
A: 1.063550
B: 0.008489
```

Исходя из полученных результатов, можно сделать вывод,\
что метод B работает значительно быстрее.\
Это связано с тем, что метод **fwrite** использует\
программный буфер, что позволяет снизить количество\
дорогостоящих операций обращения к памяти.\
В свою очередь **write** напрямую пытается обращаться\
к памяти 300 000 раз.

**№3.** *Разработать собственную версию (mytail) команды tail.\
Формат: mytail -n file\
Она читает блок из конца файла, просматривает его с конца до заданного количества строк n\
и печатает эти строки в соответствующем порядке.\
Использовать: stat(), lseek(), open(), read(), close(), ...* 

Код: **[mytail.c](https://github.com/sapiest/OS_labs/blob/master/Lab5/task3_mytail.c)**

**№4.** *Разработать собственную версию (mystat) команды stat,\
которая просто осуществляет системный вызов stat(), \
выводит размер, число задействованных блоков, число ссылок и т.д.\
Отследить, как меняется число ссылок, когда изменяется содержимое директории.*

Код: **[mytail.c](https://github.com/sapiest/OS_labs/blob/master/Lab5/task4.c)**

При изменении содержимого директории число ссылок не изменяется. 


**№5.** *Разработать собственную версию (myls) команды ls, которая выводит список файлов в заданной директории.\
С ключом -l она выводит информацию о каждом файле, включая собственника, группу, разрешения и т.д.,\
получаемые из системного вызова stat().\
Формат: myls -l directory (или текущую директорию, если параметр не задан)\
Использовать: stat(), opendir(), readdir(), getcwd(), ...*

Код: **[myls.c](https://github.com/sapiest/OS_labs/blob/master/Lab5/task5_myls.c)**

**№6.** *Разработать программу, которая выводит имена каждого файла и директории, начиная с заданной точки в дереве каталогов.\
a) Без аргументов: сначала текущая директория и ее содержимое, затем поддиректории и т.д.\
(пока не закончится дерево, root в качестве CWD).\
b) С одним аргументом (который есть имя директории): все поддерево, начиная с заданной директории.\
c) А также еще один какой-либо интересный вариант (см. опции для find).*

Код: **[myfind.c](https://github.com/sapiest/OS_labs/blob/master/Lab5/task6_myfind.c)**

Format: ```./myfind [<dir_name>][-name][<file_name>]```

a) поиск по текущей директории\
б) поиск по конкретной директории\
в) поиск по имени в текущей/конеретной директории. Флаг -name